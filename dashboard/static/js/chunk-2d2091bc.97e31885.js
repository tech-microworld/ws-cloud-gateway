(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d2091bc"],{a83b:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"filter-container"},[a("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"success",icon:"el-icon-plus",size:"small"},on:{click:t.handleCreate}},[t._v("添加")])],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],attrs:{"span-method":t.objectSpanMethod,data:t.list,"element-loading-text":"Loading",border:"",fit:"","highlight-current-row":""}},[a("el-table-column",{attrs:{label:"服务名",width:"110",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.service_name))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"upstream",align:"left"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.upstream))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"权重",width:"50",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.weight))])]}}])}),t._v(" "),a("el-table-column",{attrs:{"class-name":"status-col",label:"状态",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:t._f("statusFilter")(e.row.status)}},[t._v(t._s(t._f("dict")(e.row.status,"serviceStatus")))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"更新时间",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("parseTime")(e.row.time)))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",width:"230","class-name":"small-padding fixed-width"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.handleUpdate(s)}}},[t._v("修改")]),t._v(" "),"deleted"!=s.status?a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.handleDelete(s)}}},[t._v("删除")]):t._e()]}}])})],1),t._v(" "),a("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{ref:"dataForm",staticStyle:{width:"400px margin-left:50px"},attrs:{rules:t.dataFormRules,model:t.dataFormModel,"label-position":"right","label-width":"85px",size:"mini"}},[a("el-form-item",{attrs:{label:"服务名",prop:"service_name"}},[a("el-input",{attrs:{readonly:"update"==t.dialogStatus},model:{value:t.dataFormModel.service_name,callback:function(e){t.$set(t.dataFormModel,"service_name",e)},expression:"dataFormModel.service_name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"upstream",prop:"upstream"}},[a("el-input",{attrs:{readonly:"update"==t.dialogStatus},model:{value:t.dataFormModel.upstream,callback:function(e){t.$set(t.dataFormModel,"upstream",e)},expression:"dataFormModel.upstream"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"权重",prop:"weight"}},[a("el-input-number",{attrs:{min:1,max:100},model:{value:t.dataFormModel.weight,callback:function(e){t.$set(t.dataFormModel,"weight",e)},expression:"dataFormModel.weight"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"是否上线",prop:"status"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:t.dataFormModel.status,callback:function(e){t.$set(t.dataFormModel,"status",e)},expression:"dataFormModel.status"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitDataForm()}}},[t._v("提交")])],1)],1)],1)},i=[],n=a("b775");function o(t){return Object(n["a"])({url:"/admin/services/list",method:"get",params:t})}function l(t){return Object(n["a"])({url:"/admin/services/remove",method:"post",data:t})}function r(t){return Object(n["a"])({url:"/admin/services/save",method:"post",data:t})}var u={key:"",service_name:"",upstream:"",weight:1,status:1},d={filters:{statusFilter:function(t){var e={1:"success",0:"danger"};return e[t]}},data:function(){return{spanCol:[],pos:0,list:null,listLoading:!0,dataFormModel:Object.assign({},u),dialogFormVisible:!1,dialogStatus:"",textMap:{update:"修改服务节点",create:"添加服务节点"},dialogPvVisible:!1,plugins:[],dataFormRules:{upstream:[{required:!0,message:"请输入upstream",trigger:"blur"}],service_name:[{required:!0,message:"请输入服务名",trigger:"blur"}]}}},created:function(){this.getList()},methods:{getSpanCol:function(t){this.clearSpan();for(var e=0;e<t.length;e++)0===e?(this.spanCol.push(1),this.pos=0):t[e].service_name===t[e-1].service_name?(this.spanCol[this.pos]+=1,this.spanCol.push(0)):(this.spanCol.push(1),this.pos=e)},objectSpanMethod:function(t){t.row,t.column;var e=t.rowIndex,a=t.columnIndex;if(0===a){var s=this.spanCol[e],i=s>0?1:0;return{rowspan:s,colspan:i}}},clearSpan:function(){this.spanCol=[],this.pos=0},getList:function(){var t=this;this.listLoading=!0,o().then((function(e){t.list=e.data,t.listLoading=!1,t.getSpanCol(t.list)}))},resetFormModel:function(){this.dataFormModel=Object.assign({},u)},handleCreate:function(){var t=this;this.resetFormModel(),this.dialogStatus="create",this.dialogFormVisible=!0,this.$nextTick((function(){t.$refs.dataForm.clearValidate()}))},handleUpdate:function(t){var e=this;this.dataFormModel=Object.assign({},t),this.dialogStatus="update",this.dialogFormVisible=!0,this.$nextTick((function(){e.$refs.dataForm.clearValidate()}))},submitDataForm:function(){var t=this;this.$refs.dataForm.validate((function(e){e&&r(t.dataFormModel).then((function(){t.dialogFormVisible=!1,t.getList(),t.$notify({title:"完成",message:"提交成功",type:"success",duration:2e3})}))}))},handleDelete:function(t){var e=this,a="<span>确定删除服务节点?</span>\n                    <p>\n                    <span>如确删除请输入<strong>[".concat(t.upstream,"]</strong></span>");this.$prompt(a,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",dangerouslyUseHTMLString:!0,type:"warning",beforeClose:function(a,s,i){"confirm"===a?t.upstream===s.inputValue?i():e.$message.error("输入内容不匹配"):i()}}).then((function(){l({key:t.key}).then((function(){e.getList(),e.$notify({title:"完成",message:"删除成功",type:"success",duration:2e3})}))}))}}},c=d,m=a("2877"),p=Object(m["a"])(c,s,i,!1,null,"1db2ae74",null);e["default"]=p.exports}}]);